<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mtps思想診断</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        :root {
            --color-bg: #050505;
            --color-text: #e0e6ed;
            --color-accent: #64ffda;
            --color-dim: #4a5568;
            
            /* Type Colors */
            --color-a: #ff4757; /* 回帰淘汰 Red */
            --color-b: #2ed573; /* 共命包摂 Green */
            --color-c: #1e90ff; /* 適応進転 Blue */
            --color-d: #a4b0be; /* 無差総質 Gray */

            --font-main: 'Noto Sans JP', sans-serif;
            --font-mono: 'Share Tech Mono', monospace;

            /* Default sizes (will be updated by JS) */
            --container-width: 900px;
            --btn-height: 60px;
            --font-scale: 1;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--color-bg);
            color: var(--color-text);
            font-family: var(--font-main);
            min-height: 100vh;
            overflow-x: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Desktop Mode: Immersive (No Scroll) */
        body.mode-desktop {
            height: 100vh;
            overflow: hidden;
        }

        /* Mobile Mode: Scrollable */
        body.mode-mobile {
            height: auto;
            overflow-y: auto;
            align-items: flex-start;
            padding: 2rem 0;
        }

        /* Scanline effect */
        .scanline {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1));
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 100;
        }

        .container {
            width: 100%;
            max-width: var(--container-width);
            padding: 2rem;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            transition: max-width 0.5s ease;
            background: rgba(255, 255, 255, 0.01);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        body.mode-desktop .container {
            height: 90vh;
        }

        body.mode-mobile .container {
            height: auto;
            min-height: 80vh;
        }

        /* --- Screens --- */
        .screen {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            padding: 2rem; 
        }

        body.mode-desktop .screen {
            position: absolute;
            top: 0;
            left: 0;
        }

        body.mode-mobile .screen {
            display: none;
            position: relative;
            height: auto;
            min-height: 60vh;
        }

        .screen.active {
            opacity: 1;
            visibility: visible;
        }

        body.mode-mobile .screen.active {
            display: flex;
        }


        /* --- Typography & Buttons --- */
        h1 {
            font-family: var(--font-mono);
            font-size: calc(2.5rem * var(--font-scale));
            text-transform: uppercase;
            letter-spacing: 0.2em;
            margin-bottom: 1rem;
            text-align: center;
            color: var(--color-accent);
            text-shadow: 0 0 10px rgba(100, 255, 218, 0.3);
        }

        .subtitle {
            font-size: calc(1rem * var(--font-scale));
            color: var(--color-dim);
            margin-bottom: 3rem;
            text-align: center;
            max-width: 600px;
            line-height: 1.6;
        }

        .btn {
            background: transparent;
            border: 1px solid var(--color-accent);
            color: var(--color-accent);
            padding: 1rem 3rem;
            font-size: calc(1.2rem * var(--font-scale));
            font-family: var(--font-mono);
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin: 0.5rem;
            white-space: nowrap;
        }

        .btn:hover {
            background: var(--color-accent);
            color: var(--color-bg);
            box-shadow: 0 0 20px rgba(100, 255, 218, 0.4);
        }
        
        .mode-select-grid {
            display: grid;
            gap: 1rem;
            width: 100%;
            max-width: 600px;
        }
        
        .mode-btn {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(0,0,0,0.3);
            cursor: pointer;
            transition: 0.3s;
            text-align: left;
        }
        .mode-btn:hover {
            border-color: var(--color-accent);
            background: rgba(100, 255, 218, 0.1);
        }
        .mode-info h3 {
            font-family: var(--font-mono);
            color: var(--color-accent);
            font-size: 1.2rem;
            margin-bottom: 0.3rem;
        }
        .mode-info p {
            font-size: 0.8rem;
            color: #888;
        }
        .time-est {
            font-size: 0.75rem;
            color: var(--color-dim);
            margin-top: 0.2rem;
            font-family: var(--font-mono);
        }

        .btn-share {
            border-color: #1DA1F2;
            color: #1DA1F2;
        }
        .btn-share:hover {
            background: #1DA1F2;
            color: #ffffff;
            box-shadow: 0 0 20px rgba(29, 161, 242, 0.4);
        }

        /* --- Warning Screen Styles --- */
        .warning-box {
            background: rgba(255, 71, 87, 0.05); /* Red tint */
            border: 1px solid var(--color-a);
            padding: 2rem;
            max-width: 700px;
            width: 100%;
            margin-bottom: 2rem;
            text-align: left;
        }
        
        .warning-box h3 {
            color: var(--color-a);
            font-family: var(--font-mono);
            margin-bottom: 1.5rem;
            border-bottom: 1px solid rgba(255, 71, 87, 0.3);
            padding-bottom: 0.5rem;
        }

        .warning-box ul {
            list-style-type: none;
            padding: 0;
        }

        .warning-box li {
            margin-bottom: 1rem;
            padding-left: 1.5rem;
            position: relative;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .warning-box li::before {
            content: "!";
            position: absolute;
            left: 0;
            color: var(--color-a);
            font-weight: bold;
            font-family: var(--font-mono);
        }

        /* --- Device Selection --- */
        .device-grid {
            display: flex;
            gap: 2rem;
            justify-content: center;
            margin-top: 2rem;
        }
        .device-card {
            border: 1px solid var(--color-dim);
            padding: 2rem;
            cursor: pointer;
            transition: 0.3s;
            text-align: center;
        }
        .device-card:hover {
            border-color: var(--color-accent);
            background: rgba(100, 255, 218, 0.05);
        }
        .device-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
            display: block;
        }

        /* --- Quiz Layout --- */
        .progress-container {
            width: 100%;
            padding: 1rem 0;
            margin-bottom: 2rem;
        }
        
        body.mode-desktop .progress-container {
            position: absolute;
            top: 0;
            left: 0;
            padding: 1rem 2rem;
            margin-bottom: 0;
        }

        .progress-bar-bg {
            width: 100%;
            height: 4px;
            background: #2d3748;
            margin-bottom: 0.5rem;
        }

        .progress-bar-fill {
            height: 100%;
            background: var(--color-accent);
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px var(--color-accent);
        }

        .question-box {
            text-align: center;
            margin-bottom: 2rem;
            width: 100%;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .question-text {
            font-size: calc(1.4rem * var(--font-scale));
            font-weight: 700;
            line-height: 1.6;
        }

        .options-grid {
            display: grid;
            gap: 10px;
            width: 100%;
            margin-bottom: 2rem;
        }
        
        body.mode-desktop .options-grid {
            grid-template-columns: repeat(5, 1fr);
        }
        body.mode-mobile .options-grid {
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .option-btn {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--color-text);
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: var(--btn-height);
        }
        
        body.mode-mobile .option-btn {
            flex-direction: row;
            justify-content: flex-start;
            padding-left: 1.5rem;
            gap: 1rem;
            text-align: left;
        }

        .option-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--color-accent);
        }

        /* --- Result --- */
        .result-content {
            display: grid;
            gap: 2rem;
            align-items: center;
            width: 100%;
        }
        
        body.mode-desktop .result-content {
            grid-template-columns: 1fr 1.2fr;
            padding: 2rem;
            height: 100%;
            overflow-y: auto;
        }
        body.mode-mobile .result-content {
            grid-template-columns: 1fr;
            align-content: start;
        }

        .chart-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .chart-container {
            position: relative;
            width: 280px;
            height: 280px;
            border-radius: 50%;
            background: conic-gradient(from 0deg, #333 0% 100%);
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            margin-bottom: 1rem;
        }
        
        .chart-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70%;
            height: 70%;
            background: var(--color-bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 2;
        }

        .result-text-area {
            padding: 1.5rem;
            background: rgba(255,255,255,0.03);
            border-left: 4px solid var(--color-dim);
            text-align: left;
        }

        body.mode-desktop .result-text-area {
            overflow-y: auto;
            max-height: 60vh;
        }
        body.mode-mobile .result-text-area {
            overflow-y: visible;
            height: auto;
            max-height: none;
        }

        .legend {
            display: flex;
            gap: 0.8rem;
            justify-content: center;
            flex-wrap: wrap;
            font-size: 0.8rem;
            font-family: var(--font-mono);
        }
        .legend-item { display: flex; align-items: center; gap: 4px; }
        .legend-color { width: 8px; height: 8px; border-radius: 50%; }

        /* --- Database Screen Styles --- */
        .db-container {
            width: 100%;
            height: 100%;
            overflow-y: auto;
            padding: 1rem;
            text-align: left;
        }
        
        .db-section {
            margin-bottom: 3rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 2rem;
        }
        
        .db-h2 {
            font-family: var(--font-mono);
            color: var(--color-accent);
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .db-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.05);
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 3px solid #555;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .db-card:hover {
            background: rgba(255,255,255,0.07);
            transform: translateX(5px);
        }
        
        .db-card h3 {
            font-size: 1.1rem;
            margin-bottom: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .db-card h4 {
            font-size: 1.1rem;
            margin-bottom: 0.3rem;
        }

        .db-short-desc {
            font-size: 0.8rem; 
            color: #888;
            display: block;
        }

        .db-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            opacity: 0;
        }

        .db-card.active .db-details {
            max-height: 500px; /* Limit expansion */
            opacity: 1;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255,255,255,0.1);
            transition: max-height 0.5s ease-in, opacity 0.5s ease-in;
        }

        .db-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0a0b10;
        }
        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--color-accent);
        }

    </style>
</head>
<body class="mode-desktop">

    <div class="scanline"></div>

    <div class="container" id="main-container">
        
        <!-- Screen 0: Device Selection -->
        <div id="device-screen" class="screen active">
            <h1>SYSTEM BOOT</h1>
            <p class="subtitle">SELECT INTERFACE MODE</p>
            
            <div class="device-grid">
                <div class="device-card" onclick="setMode('desktop')">
                    <span class="device-icon">💻</span>
                    <div style="font-family: var(--font-mono); font-size: 1.2rem;">DESKTOP</div>
                    <div style="font-size: 0.8rem; color: #888; margin-top: 0.5rem;">広域表示 / マウス操作</div>
                </div>
                <div class="device-card" onclick="setMode('mobile')">
                    <span class="device-icon">📱</span>
                    <div style="font-family: var(--font-mono); font-size: 1.2rem;">MOBILE</div>
                    <div style="font-size: 0.8rem; color: #888; margin-top: 0.5rem;">縦長表示 / タッチ操作</div>
                </div>
            </div>
        </div>

        <!-- Screen 0.5: Warning -->
        <div id="warning-screen" class="screen">
            <h1 style="font-family: var(--font-mono); color: var(--color-a); text-shadow: 0 0 10px rgba(255, 71, 87, 0.3);">WARNING</h1>
            <div class="warning-box">
                <h3>注意事項 / NOTICE</h3>
                <ul>
                    <li>正確な結果を得るために、直感に従って正直に回答してください。</li>
                    <li>この診断結果は絶対的なものではありません。あくまでエンターテインメントとしてお楽しみいただき、結果を鵜呑みにしないでください。</li>
                    <li>
                        バグ報告・お問い合わせは下記までお願いします。<br>
                        Email: unknownthedelta@gmail.com<br>
                        X: <a href="https://twitter.com/Metalepsis_jp" target="_blank" style="color:var(--color-accent); text-decoration:none;">@Metalepsis_jp</a>
                    </li>
                </ul>
            </div>
            <button class="btn" onclick="goToIntro()" style="border-color: var(--color-a); color: var(--color-a);">AGREE & PROCEED</button>
        </div>

        <!-- Screen 1: Intro (Mode Selection) -->
        <div id="intro-screen" class="screen">
            <h1>Metalepsis_ Type<br>IDEOLOGY PROFILER v1.1</h1>
            <p class="subtitle">
                診断モードを選択してください。
            </p>
            
            <div class="mode-select-grid">
                <div class="mode-btn" onclick="startQuiz(25)">
                    <div class="mode-info">
                        <h3>STANDARD</h3>
                        <p>一般思想診断 / 25問 / 簡易分析</p>
                        <p class="time-est">目安時間: 3~8分</p>
                    </div>
                    <span style="font-family: var(--font-mono); color:var(--color-accent);">></span>
                </div>
                <div class="mode-btn" onclick="startQuiz(50)">
                    <div class="mode-info">
                        <h3>LIGHT PRECISION</h3>
                        <p>軽精密思想診断 / 50問 / 詳細分析</p>
                        <p class="time-est">目安時間: 8~15分</p>
                    </div>
                    <span style="font-family: var(--font-mono); color:var(--color-accent);">></span>
                </div>
                <div class="mode-btn" onclick="startQuiz(100)">
                    <div class="mode-info">
                        <h3>HEAVY PRECISION</h3>
                        <p>重精密思想診断 / 100問 / 徹底解析</p>
                        <p class="time-est">目安時間: 15~30分</p>
                    </div>
                    <span style="font-family: var(--font-mono); color:var(--color-accent);">></span>
                </div>
            </div>

            <div style="margin-top: 2rem;">
                <button class="btn" onclick="showDatabase()" style="font-size: 0.9rem; padding: 0.5rem 1.5rem; border-color: var(--color-dim); color: var(--color-dim);">DATABASE</button>
            </div>
        </div>

        <!-- Screen 1.5: Database (Reference) -->
        <div id="database-screen" class="screen">
            <div class="db-container">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <h1 style="font-size: 1.8rem; margin-bottom: 0.5rem;">DATABASE</h1>
                    <p style="color: #888; font-size: 0.9rem;">評価基準および診断結果一覧</p>
                </div>

                <!-- Section 1: The 4 Axes -->
                <div class="db-section">
                    <h2 class="db-h2">1. 評価の4つの基軸</h2>
                    <div class="db-grid">
                        <div class="db-card" style="border-left-color: var(--color-a);">
                            <h3 style="color: var(--color-a);">【A】 回帰淘汰主義</h3>
                            <p style="font-size: 0.9rem; line-height: 1.6; margin-top:0.5rem;">
                                <strong>核心:</strong> 秩序、純潔、選別、伝統<br>
                                <strong>動機:</strong> 混沌を恐れ、世界を「本来あるべき美しい姿」に戻したい。<br>
                                <strong>特徴:</strong> 規律を重んじ、異物を排除することで安定を図る。内側の結束は固い。
                            </p>
                        </div>
                        <div class="db-card" style="border-left-color: var(--color-b);">
                            <h3 style="color: var(--color-b);">【B】 共命包摂主義</h3>
                            <p style="font-size: 0.9rem; line-height: 1.6; margin-top:0.5rem;">
                                <strong>核心:</strong> 慈愛、多様性、生存、感情<br>
                                <strong>動機:</strong> どのような命も否定せず、全てを抱きしめて共に生きたい。<br>
                                <strong>特徴:</strong> 効率よりも情緒や生存権を優先する。優しさゆえに停滞を招くこともある。
                            </p>
                        </div>
                        <div class="db-card" style="border-left-color: var(--color-c);">
                            <h3 style="color: var(--color-c);">【C】 適応進転主義</h3>
                            <p style="font-size: 0.9rem; line-height: 1.6; margin-top:0.5rem;">
                                <strong>核心:</strong> 進化、技術、効率、未来<br>
                                <strong>動機:</strong> 不完全さを嘆き、人間性を捨ててでも高次の存在へ変わりたい。<br>
                                <strong>特徴:</strong> 合理性を最優先し、感情や伝統をバグとして処理する。冷徹だが解決力がある。
                            </p>
                        </div>
                        <div class="db-card" style="border-left-color: var(--color-d);">
                            <h3 style="color: var(--color-d);">【D】 無差総質主義</h3>
                            <p style="font-size: 0.9rem; line-height: 1.6; margin-top:0.5rem;">
                                <strong>核心:</strong> 平等、同質、共有、平穏<br>
                                <strong>動機:</strong> 争いの原因となる「個体差」を憎み、境界線を溶かして一つになりたい。<br>
                                <strong>特徴:</strong> 突出した才能や個性を否定し、完全な平等を求める。究極の平和だが個の死に近い。
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Section 2: Logic -->
                <div class="db-section">
                    <h2 class="db-h2">2. 判定ロジック</h2>
                    <div style="font-size: 0.9rem; line-height: 1.8;">
                        <p><strong>1. 中立判定 (Neutral):</strong> スコアのばらつきが極端に小さい場合、「観測者」と判定されます。</p>
                        <p><strong>2. 複合判定 (Hybrid/Tri-brid):</strong> 上位スコアの差が僅差（15%以内）の場合、複数の思想を併せ持つと判定されます。</p>
                        <p><strong>3. 単独判定 (+/-):</strong> 1つの思想が突出している場合。獲得スコア割合が<strong>40%以上なら「熱狂（+）」</strong>、40%未満なら「穏健（-）」と判定されます。</p>
                    </div>
                </div>

                <!-- Section 3: List (Dynamic Content) -->
                <div class="db-section" style="border-bottom: none;">
                    <h2 class="db-h2">3. 診断結果一覧</h2>
                    <p style="font-size: 0.8rem; color:#888; margin-bottom:1rem;">※カードをクリックすると詳細が表示されます</p>
                    
                    <div id="db-list-container">
                        <!-- JS renders here -->
                    </div>
                </div>

                <div style="text-align: center; margin-top: 2rem;">
                    <button class="btn" onclick="hideDatabase()">BACK TO MENU</button>
                </div>
            </div>
        </div>

        <!-- Screen 2: Quiz -->
        <div id="quiz-screen" class="screen">
            <div class="progress-container">
                <div class="progress-bar-bg">
                    <div id="progress-fill" class="progress-bar-fill"></div>
                </div>
                <div style="display:flex; justify-content:space-between; font-family:var(--font-mono); font-size:0.8rem; color:var(--color-dim);">
                    <span id="section-title">SECTION 1</span>
                    <span>Q.<span id="current-q">1</span>/<span id="total-q">25</span></span>
                </div>
            </div>

            <div class="question-box">
                <p id="question-text" class="question-text">読み込み中...</p>
            </div>

            <div class="options-grid">
                <button class="option-btn" onclick="handleAnswer(2)">
                    <span style="font-size:1.2rem; color:var(--color-accent)">●</span> <span>非常にそう思う</span>
                </button>
                <button class="option-btn" onclick="handleAnswer(1)">
                    <span style="font-size:1rem;">○</span> <span>そう思う</span>
                </button>
                <button class="option-btn" onclick="handleAnswer(0)">
                    <span style="font-size:1rem; opacity:0.5">-</span> <span>どちらとも言えない</span>
                </button>
                <button class="option-btn" onclick="handleAnswer(-1)">
                    <span style="font-size:1rem;">×</span> <span>そう思わない</span>
                </button>
                <button class="option-btn" onclick="handleAnswer(-2)">
                    <span style="font-size:1.2rem; color:var(--color-a)">✕</span> <span>非常にそう思わない</span>
                </button>
            </div>
        </div>

        <!-- Screen 3: Result -->
        <div id="result-screen" class="screen">
            <div class="result-content">
                <!-- Chart Area -->
                <div class="chart-wrapper">
                    <div id="pie-chart" class="chart-container">
                        <div class="chart-overlay">
                            <span style="font-size: 0.8rem; color: #888; font-family:var(--font-mono);">Type</span>
                            <span id="result-code" style="font-size: 2.5rem; font-weight:bold; font-family:var(--font-mono);">--</span>
                        </div>
                    </div>
                    <div class="legend" id="result-legend">
                        <div class="legend-item"><div class="legend-color" style="background:var(--color-a)"></div>回帰淘汰 (A)</div>
                        <div class="legend-item"><div class="legend-color" style="background:var(--color-b)"></div>共命包摂 (B)</div>
                        <div class="legend-item"><div class="legend-color" style="background:var(--color-c)"></div>適応進転 (C)</div>
                        <div class="legend-item"><div class="legend-color" style="background:var(--color-d)"></div>無差総質 (D)</div>
                    </div>
                </div>

                <!-- Text Area -->
                <div class="result-text-area" id="result-card">
                    <div id="result-title" style="font-size: 1.4rem; font-weight: bold; margin-bottom: 0.5rem;">分析中...</div>
                    <div id="result-quote" style="font-style: italic; color: #888; margin-bottom: 1rem; border-bottom: 1px solid #333; padding-bottom: 0.5rem;">...</div>
                    <div id="result-desc" style="font-size: 0.95rem; line-height: 1.8;">...</div>
                    
                    <div style="margin-top: 2rem; text-align: center; display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap;">
                        <button class="btn" onclick="restartQuiz()" style="padding: 0.5rem 2rem; font-size: 1rem;">RESET</button>
                        <button class="btn btn-share" onclick="shareOnTwitter()" style="padding: 0.5rem 2rem; font-size: 1rem;">SHARE (X)</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
    // --- Question Pool (100 Questions) ---
    const questionPool = [
        // Original 25
        { t: "生まれ持った資質や才能の差は、その人の運命や役割を決定づける重要な要素である。", type: "A", s: "価値" },
        { t: "弱き者がそのまま生きられる社会よりも、弱き者が強き者へと変われる手助けをする社会こそが健全だ。", type: "C", s: "価値" },
        { t: "どのような凶悪な犯罪者であっても、その存在の根源的な価値は聖人と同じである。", type: "B", s: "価値" },
        { t: "個人の『個性』や『自分らしさ』への固執こそが、人間社会に不幸をもたらす元凶だ。", type: "D", s: "価値" },
        { t: "美しい庭を保つためには、時として雑草を抜くように、社会全体のために一部を間引く決断もやむを得ない。", type: "A", s: "価値" },
        { t: "多様な意見を認め合うことは大切だが、それが結論の先送りや停滞を招くなら、強力なリーダーシップで統一すべきだ。", type: "A", s: "倫理" },
        { t: "過去の過ちや欠陥を許容する優しさよりも、それを技術やシステムで『二度と起きないように修正する』ことこそが本当の愛だ。", type: "C", s: "倫理" },
        { t: "誰かが悲しむくらいなら、全員が同じ感情、同じ幸福度で生きられるように調整された世界の方が良い。", type: "D", s: "倫理" },
        { t: "効率や進化のために誰かが犠牲になることは、倫理的に決して許されない。", type: "B", s: "倫理" },
        { t: "世界がカオス（混沌）に陥るくらいなら、厳しい規律によって管理された静寂の方が好ましい。", type: "A", s: "倫理" },
        { t: "社会の構成員は、それぞれの能力に応じて明確に区別・管理されるべきだ。", type: "A", s: "統治" },
        { t: "理想的な社会とは、全ての人間が『同じ顔、同じ思考』を持ち、対立の概念すら消滅した状態である。", type: "D", s: "統治" },
        { t: "現状の肉体や精神に限界を感じるならば、機械化や遺伝子操作を行ってでも『より高次な存在』を目指すべきだ。", type: "C", s: "統治" },
        { t: "役に立たないと思われる存在であっても、それが社会という生態系の一部として機能していることを忘れてはならない。", type: "B", s: "統治" },
        { t: "不平等を是正するために富を分配するより、不平等そのものが無意味になるよう、全員の精神構造を統一する方が根本解決になる。", type: "D", s: "統治" },
        { t: "対立する相手を説得する時間があるなら、相手を『自分と同じ考え』になるようアップデート（改造）してあげた方が互いのためだ。", type: "C", s: "対立" },
        { t: "純粋な水を濁らせないためには、最初から不純物を入れない、あるいは見つけ次第取り除く厳格さが必要だ。", type: "A", s: "対立" },
        { t: "争いは『私』と『あなた』という境界線があるから生まれる。その境界線を溶かしてしまえば平和が訪れる。", type: "D", s: "対立" },
        { t: "理解し合えない他者がいたとしても、その不快感と共に生きることこそが成熟した社会の姿だ。", type: "B", s: "対立" },
        { t: "『欠落』や『病』は、治療し克服すべきエラーであり、それを受け入れて共存するのは敗北に等しい。", type: "C", s: "対立" },
        { t: "世界を救うために『選ばれた1000人』だけを残し、残りを切り捨てる箱舟の扉を、あなたは閉めることができる。", type: "A", s: "選択" },
        { t: "全人類の意識を統合し、個を消滅させることで永遠の平穏が得られるスイッチがあるなら、迷わず押すべきだ。", type: "D", s: "選択" },
        { t: "致死率の高いウイルスが蔓延した際、人権を無視してでも全市民に強制的に人体改造（ワクチン以上の身体強化）を施すべきだ。", type: "C", s: "選択" },
        { t: "たとえ人類が滅亡するとしても、誰かの命を意図的に選別したり、強制的に変質させたりする権利は誰にもない。", type: "B", s: "選択" },
        { t: "『不完全なまま愛し合う世界』と『完全無欠で孤独な世界』。選ぶなら前者だ。", type: "B", s: "選択" },
        // Previous 25 Questions for Precision
        { t: "伝統や歴史的背景を持たない『新しいもの』は、既存の秩序を乱すノイズになりやすい。", type: "A", s: "伝統" },
        { t: "苦しみを取り除くためなら、人類が人間という生物種でなくなっても構わない。", type: "C", s: "進化" },
        { t: "『優秀な遺伝子』を残すことよりも、『全ての遺伝子』が残る可能性を模索するべきだ。", type: "B", s: "生存" },
        { t: "名前も顔も履歴も全て捨て去り、ただの『番号』として管理される社会に安らぎを感じる。", type: "D", s: "匿名" },
        { t: "汚れた部屋を掃除する時、使えるものまで捨ててしまうリスクを恐れては、真の清潔さは手に入らない。", type: "A", s: "浄化" },
        { t: "自然な老化や死を受け入れることは美徳ではなく、技術的な敗北である。", type: "C", s: "技術" },
        { t: "たとえ非効率で愚かな選択であっても、他者が『間違える権利』を尊重すべきだ。", type: "B", s: "自由" },
        { t: "他人との比較で生まれる劣等感を消す最良の方法は、全員の能力を均一化することだ。", type: "D", s: "平等" },
        { t: "血統や純潔を守ることは、差別ではなく種としての誇りである。", type: "A", s: "血統" },
        { t: "感情は判断を鈍らせるバグであり、論理的最適解を導くためには抑制・削除すべきだ。", type: "C", s: "理性" },
        { t: "弱肉強食は自然の摂理かもしれないが、文明とはそれに抗うためにある。", type: "B", s: "文明" },
        { t: "私有財産だけでなく、私有的な『感情』や『記憶』も共有財産とすべきだ。", type: "D", s: "共有" },
        { t: "一度汚染された大地は、再生させるよりも封鎖して見捨てる方が合理的だ。", type: "A", s: "放棄" },
        { t: "人間は環境に適応するのではなく、環境を人間に合わせて作り変えるべきだ。", type: "C", s: "支配" },
        { t: "どのような異端な思想であっても、社会の片隅に居場所を用意する度量が世界には必要だ。", type: "B", s: "寛容" },
        { t: "『特別な誰か』になろうとする野心こそが、平穏な日常を破壊する。", type: "D", s: "野心" },
        { t: "美しさとは『混ざりけのないこと』であり、複雑さは醜さの一形態に過ぎない。", type: "A", s: "美学" },
        { t: "記憶をデータ化し、永遠に生きられるサーバーがあるなら、肉体を捨ててアップロードする。", type: "C", s: "永遠" },
        { t: "傷つけ合うことなしに、深い理解や愛は生まれない。", type: "B", s: "関係" },
        { t: "壁のない家に住み、隠し事のない生活を送ることは、監視ではなく信頼の極致だ。", type: "D", s: "開放" },
        { t: "救命ボートが定員オーバーの時、未来ある若者を優先し、老人は海に落とすべきだ。", type: "C", s: "功利" },
        { t: "『敵』の子供であっても、助けを求められれば手を差し伸べるのが人の道だ。", type: "B", s: "人道" },
        { t: "正義の反対は悪ではなく、『別の正義』である。ゆえに、どちらか一つが消えるまで戦うしかない。", type: "A", s: "決着" },
        { t: "言葉による誤解をなくすためなら、全人類の言語を統一し、思考のニュアンスまで規格化すべきだ。", type: "D", s: "統一" },
        { t: "何も生み出さず、何も消費しない植物のような状態で、ただ『存在する』だけの幸福も認められるべきだ。", type: "B", s: "存在" },
        // Newly Added 50 Questions (Total 100)
        // A
        { t: "汚れた血筋は、何代かけても浄化されることはない。", type: "A", s: "血統" },
        { t: "規律を乱す芸術は、退廃的であり禁止されるべきだ。", type: "A", s: "芸術" },
        { t: "完璧な辞書を作るためには、曖昧な言葉を削除し続ける必要がある。", type: "A", s: "定義" },
        { t: "「例外」を認めることが、すべての崩壊の始まりだ。", type: "A", s: "原則" },
        { t: "美しい街並みとは、ゴミ一つなく、住民の服装すら統一された状態のことだ。", type: "A", s: "美観" },
        { t: "過去の偉人たちが築いた伝統こそが、未来永劫守るべき唯一の正解だ。", type: "A", s: "正統" },
        { t: "異物は、排除されるか、同化されるかの二択しかない。", type: "A", s: "異物" },
        { t: "清掃とは、単に汚れを取ることではなく、精神を磨く儀式である。", type: "A", s: "精神" },
        { t: "ノイズの多い議論よりも、沈黙による服従の方が美しい。", type: "A", s: "静寂" },
        { t: "壁は、外敵を防ぐためではなく、内側の純度を保つためにある。", type: "A", s: "境界" },
        { t: "指導者の言葉は法であり、解釈の余地を与えてはならない。", type: "A", s: "権威" },
        { t: "混血や融合は多様性ではなく、ただの劣化である。", type: "A", s: "純度" },
        { t: "秩序のための暴力は、暴力ではなく「外科手術」である。", type: "A", s: "断行" },
        // B
        { t: "どんなに非効率でも、全員の合意が取れるまで話し合うべきだ。", type: "B", s: "対話" },
        { t: "痛みを感じるすべての存在には、生きる権利がある。", type: "B", s: "権利" },
        { t: "枯れた花にも美しさがあり、それを捨てずに愛でる心が必要だ。", type: "B", s: "慈愛" },
        { t: "科学の進歩が誰かを傷つけるなら、その進歩は止めるべきだ。", type: "B", s: "停滞" },
        { t: "「役に立つか」で人を判断するのは、最も野蛮な行為だ。", type: "B", s: "尊厳" },
        { t: "故郷や思い出の場所は、どんな開発計画よりも優先して守られるべきだ。", type: "B", s: "記憶" },
        { t: "強さとは敵を倒す力ではなく、敵を作らない優しさのことだ。", type: "B", s: "強さ" },
        { t: "たとえ世界が滅びるとしても、最後の瞬間まで手を取り合っていたい。", type: "B", s: "絆" },
        { t: "不便さや苦労の中にこそ、人間らしい温かみがある。", type: "B", s: "人間味" },
        { t: "機械には決して理解できない「魂」の領域がある。", type: "B", s: "霊性" },
        { t: "弱者を切り捨てて得た繁栄に、何の価値もない。", type: "B", s: "正義" },
        { t: "許すことこそが、復讐の連鎖を断ち切る唯一の方法だ。", type: "B", s: "赦し" },
        // C
        { t: "肉体は単なる乗り物であり、交換可能であるべきだ。", type: "C", s: "肉体" },
        { t: "死は克服可能な技術的課題に過ぎない。", type: "C", s: "超越" },
        { t: "感情は電気信号であり、調整可能である。", type: "C", s: "制御" },
        { t: "自然のままの食品よりも、栄養素を完全に管理された合成食の方が優れている。", type: "C", s: "効率" },
        { t: "才能という不確定要素に頼るより、遺伝子編集で確実な能力を与えるべきだ。", type: "C", s: "確実性" },
        { t: "非効率な言語を捨て、脳同士を直結して通信すべきだ。", type: "C", s: "通信" },
        { t: "過去を振り返る時間は無駄であり、常に未来のシミュレーションを行うべきだ。", type: "C", s: "未来" },
        { t: "愛も友情も、ホルモンバランスの最適化で再現できる。", type: "C", s: "解析" },
        { t: "宇宙に進出するためなら、地球を使い潰しても構わない。", type: "C", s: "進出" },
        { t: "睡眠時間は人生の浪費であり、薬物や改造で短縮すべきだ。", type: "C", s: "時間" },
        { t: "失敗作は即座に廃棄し、バージョンアップ版を作るのが慈悲だ。", type: "C", s: "更新" },
        { t: "人間は「神」によって作られたのではなく、自らの手で「神」になる存在だ。", type: "C", s: "神格" },
        { t: "痛みは危険信号に過ぎず、スイッチ一つでオフにできる機能であるべきだ。", type: "C", s: "機能" },
        // D
        { t: "名前ではなく、共通のIDで呼び合う方が差別が生まれない。", type: "D", s: "記号" },
        { t: "私服は貧富の差を可視化するため、全員が制服を着るべきだ。", type: "D", s: "均一" },
        { t: "「勝者」がいるということは、必ず「敗者」が生まれるということだ。だから勝負などしない。", type: "D", s: "競争" },
        { t: "天才の存在は、凡人を不幸にするだけだ。", type: "D", s: "突出" },
        { t: "すべての家の間取り、家具、食事を同じにすれば、妬みは消える。", type: "D", s: "同質" },
        { t: "親が子供を育てる制度は格差の温床であり、社会全体で集団養育すべきだ。", type: "D", s: "養育" },
        { t: "所有欲こそが悪の根源であり、すべてをシェアすれば平和になる。", type: "D", s: "共有" },
        { t: "顔の造形による美醜の差をなくすため、全員整形するか仮面をつけるべきだ。", type: "D", s: "外見" },
        { t: "突出した杭は打たれるべきであり、平らな地平線こそが理想だ。", type: "D", s: "平準" },
        { t: "「私」という主語をなくし、「我々」とだけ言えばいい。", type: "D", s: "主語" },
        { t: "芸術は個人の表現ではなく、社会全体のプロパガンダであるべきだ。", type: "D", s: "公共" },
        { t: "違いを認めるのではなく、違いそのものを消滅させるのが究極の解決だ。", type: "D", s: "解決" }
    ];

    // --- Results Data ---
    const resultsData = {
        // --- Plus Types (Fanatic) ---
        "A+": { title: "[A+] 絶対純血主義 (Purist Zealot)", quote: "「一滴の濁りも許さない。完全なる白こそが正義だ。」", desc: "【回帰淘汰・極】<br>あなたは極めて強力な秩序の守護者です。不純物や異端に対する許容度はゼロに等しく、理想の世界のためならあらゆる犠牲を正当化します。その潔癖さは神聖ですが、同時に息苦しいほどの抑圧を生むでしょう。", color: "#ff0033" },
        "B+": { title: "[B+] 無限博愛主義 (Saint)", quote: "「全ての罪を赦そう。私がその身代わりになる。」", desc: "【共命包摂・極】<br>自己を完全に滅却して他者に尽くす、聖人のような精神性です。敵対する者さえも愛そうとしますが、その無制限の受容は、悪意ある者につけ込まれ、組織や社会を内部から崩壊させる隙にもなり得ます。", color: "#00ff88" },
        "C+": { title: "[C+] 超越進化主義 (Singularity)", quote: "「肉体は枷だ。人間であることを辞める時が来た。」", desc: "【適応進転・極】<br>進化のためなら倫理も感情も人間性も躊躇なく捨て去るマッドサイエンティスト的思考です。もはやあなたは人類という種の枠組みを超え、新たな知的生命体へと変貌しようとしています。", color: "#0066ff" },
        "D+": { title: "[D+] 全一集合主義 (The One)", quote: "「個は幻影に過ぎない。我々は一つに溶け合うのだ。」", desc: "【無差総質・極】<br>個人の自我を完全に否定し、全体意識との融合を渇望しています。あなたにとって孤独とは死以上の恐怖であり、全ての境界線が消滅した海のような意識状態こそが至高の幸福です。", color: "#888888" },

        // --- Minus Types (Moderate) ---
        "A-": { title: "[A-] 秩序維持派 (Order Keeper)", quote: "「自由には責任が伴う。最低限のルールは必要だ。」", desc: "【回帰淘汰・穏】<br>カオスを嫌いますが、過度な排除は行いません。社会システムの安定と継続性を重視する、現実的な保守派です。変化には慎重ですが、それは守るべきものがあるという責任感の表れです。", color: "#ff6b81" },
        "B-": { title: "[B-] 現状肯定派 (Status Quo)", quote: "「無理に変える必要はない。今のままで十分幸せだ。」", desc: "【共命包摂・穏】<br>急激な改革や争いを避け、今の日常を大切にしたいと願っています。消極的ですが、最も平和的な隣人です。大きな理想よりも、手の届く範囲の平穏を守ることを選びます。", color: "#7bed9f" },
        "C-": { title: "[C-] 合理改善派 (Pragmatist)", quote: "「より良くできるなら、道具を使わない手はない。」", desc: "【適応進転・穏】<br>テクノロジーや新しい手法を柔軟に取り入れる合理主義者です。人間性を捨てるつもりはありませんが、不便や非効率は我慢なりません。ドライに見えますが、実は最も建設的です。", color: "#70a1ff" },
        "D-": { title: "[D-] 公平追求派 (Fairness)", quote: "「生まれによる不平等は、できるだけ是正すべきだ。」", desc: "【無差総質・穏】<br>完全な同一化までは求めませんが、チャンスの平等や公正さを重視します。特権階級や理不尽な格差を嫌う、健全な民主的感覚の持ち主です。バランス感覚に優れています。", color: "#ced6e0" },

        // --- Hybrid Types (2-way) ---
        AB: { title: "[AB] 聖域守護主義 (Guardian)", quote: "「この庭の平穏だけは、何としても死守する。」", desc: "【回帰淘汰 × 共命包摂】<br>内側の者には無限の愛を注ぎますが、外敵には容赦ない排他性を発揮します。家族や仲間を守るためなら鬼になれる、閉鎖的な楽園の管理者です。", color: "#eebb44" },
        AC: { title: "[AC] 完全主義的独裁 (Perfectionist)", quote: "「選ばれた優秀な者が、さらに進化する。」", desc: "【回帰淘汰 × 適応進転】<br>弱者を切り捨て、残った強者をさらに強化しようとするエリート思想。強烈なカリスマ性を持ちますが、弱者にとっては地獄のような世界を作るでしょう。", color: "#a29bfe" },
        AD: { title: "[AD] 統制全体主義 (Totalitarian)", quote: "「乱れなき行進。例外は許されない。」", desc: "【回帰淘汰 × 無差総質】<br>秩序維持のために、個性を徹底的に排除する管理社会の理想形。すべての市民が同じ規格、同じ思想で動く、美しくも恐ろしい機械仕掛けの世界を望みます。", color: "#ff6b81" },
        BC: { title: "[BC] 全救済進化主義 (Uplift)", quote: "「誰も置き去りにしない。全員で神になる。」", desc: "【共命包摂 × 適応進転】<br>弱者を切り捨てるのではなく、技術や教育で全員を強者へ引き上げようとする理想家。コストと時間がかかりすぎ、破綻する可能性が高い夢物語でもあります。", color: "#00d2d3" },
        BD: { title: "[BD] 平和的停滞 (Peace Keeper)", quote: "「みんな違ってみんないい。でも、同じならもっといい。」", desc: "【共命包摂 × 無差総質】<br>争いを極端に恐れる事なかれ主義。多様性を認めつつも、本音では波風の立たない均質な世界を望んでいます。優しいディストピアの住人です。", color: "#55efc4" },
        CD: { title: "[CD] 集合知性主義 (Hive Mind)", quote: "「個を捨てよ。全となりて永遠を生きよ。」", desc: "【適応進転 × 無差総質】<br>個人の限界を技術で突破し、意識を統合することで進化しようとする思想。SF的な集合精神（ボーグや群体）こそが、人類の最終到達点だと信じています。", color: "#54a0ff" },

        // --- Tri-brid Types (3-way) ---
        ABC: { title: "[ABC] 超越的統治主義 (Overlord)", quote: "「全能なる父として、世界を導こう。」", desc: "【D(平等)欠落】<br>秩序、慈愛、進化を兼ね備えた理想的な「王」の思想ですが、そこに対等な関係はありません。あなたは民を愛し導きますが、民があなたに意見することは許されないでしょう。", color: "#ffffff" },
        ABD: { title: "[ABD] 停滞楽園主義 (Lotus Eater)", quote: "「永遠の微睡の中で、痛みだけを忘れて。」", desc: "【C(進化)欠落】<br>秩序と慈愛に満ち、争いのない平等な世界。しかし、そこには成長も変化もありません。飼い慣らされたペットのように、ただ穏やかに死を待つだけの美しい箱庭です。", color: "#88ffcc" },
        ACD: { title: "[ACD] 機械的収束主義 (The System)", quote: "「感情は不要。最適な解だけを出力せよ。」", desc: "【B(慈愛)欠落】<br>極めて効率的で、秩序立ち、平等な社会。しかし、そこに人の心や不合理な優しさは存在しません。完全無欠なシステムの一部として機能することだけが求められます。", color: "#aaddff" },
        BCD: { title: "[BCD] 原初混沌主義 (Primordial Soup)", quote: "「全ては混ざり合い、生まれ変わり続ける。」", desc: "【A(規律)欠落】<br>あらゆる命が肯定され、混ざり合い、変化し続ける生命のスープ。そこには境界線も秩序もありません。圧倒的な生命力に満ちていますが、個としての輪郭を保つことは困難でしょう。", color: "#ffaaee" },

        NEUTRAL: { title: "[NEUTRAL] 中立主義的思考 (The Observer)", quote: "「世界の天秤を眺める観測者」", desc: "どの思想にも理解を示し、同時に距離を置いています。バランサーとして機能しますが、決断を下せず時代の波に流されるだけの存在になる危険性もあります。", color: "#ffffff" }
    };

    // --- State ---
    let activeQuestions = [];
    let currentQIndex = 0;
    let scores = { A: 0, B: 0, C: 0, D: 0 };
    let currentMode = 'desktop';

    // --- DOM Elements ---
    const deviceScreen = document.getElementById('device-screen');
    const warningScreen = document.getElementById('warning-screen');
    const introScreen = document.getElementById('intro-screen');
    const quizScreen = document.getElementById('quiz-screen');
    const resultScreen = document.getElementById('result-screen');
    const databaseScreen = document.getElementById('database-screen');
    const body = document.body;

    // --- UI Logic ---
    function setMode(mode) {
        currentMode = mode;
        body.className = `mode-${mode}`;
        const root = document.documentElement;

        if (mode === 'mobile') {
            root.style.setProperty('--container-width', '450px');
            root.style.setProperty('--btn-height', '80px');
            root.style.setProperty('--font-scale', '0.9');
        } else {
            root.style.setProperty('--container-width', '900px');
            root.style.setProperty('--btn-height', '60px');
            root.style.setProperty('--font-scale', '1');
        }

        switchScreen(deviceScreen, warningScreen); // Go to Warning first
    }

    function goToIntro() {
        switchScreen(warningScreen, introScreen);
    }

    function switchScreen(from, to) {
        if (currentMode === 'mobile') {
            from.classList.remove('active');
            from.style.opacity = 0;
            to.classList.add('active');
            gsap.fromTo(to, {opacity: 0}, {opacity: 1, duration: 0.5});
        } else {
            gsap.to(from, {
                opacity: 0, 
                duration: 0.3, 
                onComplete: () => {
                    from.classList.remove('active');
                    to.classList.add('active');
                    gsap.fromTo(to, {opacity: 0, scale: 0.95}, {opacity: 1, scale: 1, duration: 0.5, ease: "power2.out"});
                }
            });
        }
    }

    function showDatabase() {
        renderDatabaseList();
        switchScreen(introScreen, databaseScreen);
    }

    function hideDatabase() {
        switchScreen(databaseScreen, introScreen);
    }

    function renderDatabaseList() {
        const container = document.getElementById('db-list-container');
        container.innerHTML = ''; // Clear previous content

        const groups = {
            fanatic: { title: "単独思想：熱狂派 (+)", items: [] },
            moderate: { title: "単独思想：穏健派 (-)", items: [] },
            hybrid: { title: "複合思想 (Hybrid / Tri-brid)", items: [] },
            neutral: { title: "特殊・中立", items: [] }
        };

        for (const [key, data] of Object.entries(resultsData)) {
            if (key === 'NEUTRAL') {
                groups.neutral.items.push({key, ...data});
            } else if (key.endsWith('+')) {
                groups.fanatic.items.push({key, ...data});
            } else if (key.endsWith('-')) {
                groups.moderate.items.push({key, ...data});
            } else {
                groups.hybrid.items.push({key, ...data});
            }
        }

        // Render groups
        [groups.fanatic, groups.moderate, groups.hybrid, groups.neutral].forEach(group => {
            if (group.items.length === 0) return;

            const groupTitle = document.createElement('h3');
            groupTitle.style.cssText = "margin: 1.5rem 0 1rem; color: #fff; border-bottom: 1px solid #333; padding-bottom: 0.5rem;";
            groupTitle.innerText = group.title;
            container.appendChild(groupTitle);

            const grid = document.createElement('div');
            grid.className = 'db-grid';

            group.items.forEach(item => {
                const card = document.createElement('div');
                card.className = 'db-card';
                card.style.borderLeftColor = item.color;
                
                // Get short desc (first line or sentence) for preview
                const shortDesc = item.desc.split('。')[0] + '...';

                card.innerHTML = `
                    <h3>${item.key.replace("NEUTRAL", "NEUTRAL")} ${item.title}</h3>
                    <span class="db-short-desc">${shortDesc}</span>
                    <div class="db-details">
                        <div style="font-style:italic; color:#aaa; margin-bottom:0.5rem; border-bottom:1px solid #444; padding-bottom:0.5rem;">${item.quote}</div>
                        <div style="line-height:1.6;">${item.desc}</div>
                    </div>
                `;

                // Add toggle event
                card.onclick = function() {
                    this.classList.toggle('active');
                };

                grid.appendChild(card);
            });

            container.appendChild(grid);
        });
    }

    // --- Quiz Logic ---
    function startQuiz(count) {
        currentQIndex = 0;
        scores = { A: 0, B: 0, C: 0, D: 0 };
        
        // Mode Setup
        if (count === 25) {
            // Standard: Random 25
            activeQuestions = [...questionPool].sort(() => 0.5 - Math.random()).slice(0, 25);
        } else if (count === 50) {
            // Light Precision: Random 50 from 100
            activeQuestions = [...questionPool].sort(() => 0.5 - Math.random()).slice(0, 50);
        } else if (count === 100) {
            // Heavy Precision: All 100 questions
            activeQuestions = [...questionPool].sort(() => 0.5 - Math.random());
        }

        document.getElementById('total-q').innerText = activeQuestions.length;
        switchScreen(introScreen, quizScreen);
        renderQuestion();
    }

    function renderQuestion() {
        const q = activeQuestions[currentQIndex];
        const qText = document.getElementById('question-text');
        
        gsap.fromTo(qText, { opacity: 0, x: 20 }, { opacity: 1, x: 0, duration: 0.4 });

        qText.innerText = q.t;
        document.getElementById('section-title').innerText = `TOPIC: ${q.s}`;
        document.getElementById('current-q').innerText = currentQIndex + 1;
        
        const progress = ((currentQIndex) / activeQuestions.length) * 100;
        document.getElementById('progress-fill').style.width = `${progress}%`;
    }

    function handleAnswer(value) {
        if (currentQIndex >= activeQuestions.length) return;

        const q = activeQuestions[currentQIndex];
        scores[q.type] += value; // Simple addition

        currentQIndex++;
        if (currentQIndex < activeQuestions.length) {
            renderQuestion();
        } else {
            showResult();
        }
    }

    function showResult() {
        document.getElementById('progress-fill').style.width = '100%';

        // Chart Data Calculation (Normalize for display)
        // Adjusted offset to 10 to make differences more visible and percentages more meaningful
        let chartData = {
            A: Math.max(0, scores.A + 10),
            B: Math.max(0, scores.B + 10),
            C: Math.max(0, scores.C + 10),
            D: Math.max(0, scores.D + 10)
        };
        const total = Object.values(chartData).reduce((a, b) => a + b, 0) || 1;
        
        // Calculate Percentages for Display
        const pA = (chartData.A / total) * 100;
        const pB = (chartData.B / total) * 100;
        const pC = (chartData.C / total) * 100;
        const pD = (chartData.D / total) * 100;

        // Sorting for Winner Determination
        let sorted = Object.keys(scores).sort((a, b) => scores[b] - scores[a]);
        
        const s1 = scores[sorted[0]];
        const s2 = scores[sorted[1]];
        const s3 = scores[sorted[2]];
        
        // Standard Deviation for Neutral
        const values = Object.values(scores);
        const mean = values.reduce((a, b) => a + b) / 4;
        const variance = values.map(x => Math.pow(x - mean, 2)).reduce((a, b) => a + b) / 4;
        const sd = Math.sqrt(variance);
        
        let resultKey = sorted[0];

        // --- Decision Tree ---
        const questionCount = activeQuestions.length;
        const neutralThreshold = questionCount * 0.1;
        const hybridThreshold = questionCount * 0.15;

        if (sd < neutralThreshold) { 
            // 1. Score deviation is very low -> NEUTRAL
            resultKey = "NEUTRAL";
        } else {
            const diff1_2 = s1 - s2;
            const diff1_3 = s1 - s3;

            if (diff1_3 <= hybridThreshold) {
                // 2. Top 3 are close -> Tri-brid
                let top3 = [sorted[0], sorted[1], sorted[2]].sort();
                let triKey = top3.join("");
                if (resultsData[triKey]) resultKey = triKey;
            } else if (diff1_2 <= hybridThreshold) {
                // 3. Top 2 are close -> Hybrid
                let top2 = [sorted[0], sorted[1]].sort();
                let biKey = top2.join("");
                if (resultsData[biKey]) resultKey = biKey;
            } else {
                // 4. Single Winner -> Check Intensity based on Percentage
                // User requirement: >= 40% is Fanatic (+), < 40% is Moderate (-)
                
                // Get the percentage of the winner
                let winnerKey = sorted[0];
                let winnerPercentage = 0;
                
                if (winnerKey === 'A') winnerPercentage = pA;
                else if (winnerKey === 'B') winnerPercentage = pB;
                else if (winnerKey === 'C') winnerPercentage = pC;
                else if (winnerKey === 'D') winnerPercentage = pD;

                if (winnerPercentage >= 40) {
                    resultKey = sorted[0] + "+";
                } else {
                    resultKey = sorted[0] + "-";
                }
            }
        }

        const data = resultsData[resultKey] || resultsData[sorted[0] + "-"]; // Fallback

        // Render Result
        switchScreen(quizScreen, resultScreen);
        
        // Chart Animation
        const chartObj = { a: 0, b: 0, c: 0, d: 0 };
        gsap.to(chartObj, {
            a: pA, b: pB, c: pC, d: pD,
            duration: 1.5,
            ease: "power2.out",
            onUpdate: () => {
                const stops = [
                    `var(--color-a) 0% ${chartObj.a}%`,
                    `var(--color-b) ${chartObj.a}% ${chartObj.a + chartObj.b}%`,
                    `var(--color-c) ${chartObj.a + chartObj.b}% ${chartObj.a + chartObj.b + chartObj.c}%`,
                    `var(--color-d) ${chartObj.a + chartObj.b + chartObj.c}% 100%`
                ];
                document.getElementById('pie-chart').style.background = `conic-gradient(from 0deg, ${stops.join(', ')})`;
            }
        });

        // Update Legend with Percentages
        document.getElementById('result-legend').innerHTML = `
            <div class="legend-item"><div class="legend-color" style="background:var(--color-a)"></div>回帰淘汰 (A): ${Math.round(pA)}%</div>
            <div class="legend-item"><div class="legend-color" style="background:var(--color-b)"></div>共命包摂 (B): ${Math.round(pB)}%</div>
            <div class="legend-item"><div class="legend-color" style="background:var(--color-c)"></div>適応進転 (C): ${Math.round(pC)}%</div>
            <div class="legend-item"><div class="legend-color" style="background:var(--color-d)"></div>無差総質 (D): ${Math.round(pD)}%</div>
        `;

        // DOM Updates
        document.getElementById('result-code').innerText = resultKey;
        document.getElementById('result-code').style.color = data.color;
        
        const rTitle = document.getElementById('result-title');
        const rQuote = document.getElementById('result-quote');
        const rDesc = document.getElementById('result-desc');
        const rCard = document.getElementById('result-card');

        rTitle.innerText = data.title;
        rTitle.style.color = data.color;
        rCard.style.borderLeftColor = data.color;
        
        rQuote.innerHTML = data.quote;
        rDesc.innerHTML = data.desc;

        gsap.from([rCard], { y: 30, opacity: 0, duration: 0.8, delay: 0.2 });
    }

    function shareOnTwitter() {
        const title = document.getElementById('result-title').innerText;
        const quote = document.getElementById('result-quote').innerText;
        
        const text = `【Mtps思想診断】\n診断結果: ${title}\n${quote}\n\nあなたの思想を解析します。`;
        const hashtags = "Mtps思想診断";
        const url = "https://unknownthedeltia.github.io/mip";

        const tweetUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&hashtags=${hashtags}&url=${encodeURIComponent(url)}`;
        
        window.open(tweetUrl, '_blank');
    }

    function restartQuiz() {
        switchScreen(resultScreen, deviceScreen);
    }
</script>
</body>
</html>
